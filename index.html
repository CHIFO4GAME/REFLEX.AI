<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reflex AI</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-body: #e5e5e7; --bg-app: #ffffff; --bg-chat: #f4f4f7;
            --text: #1d1d1f; --msg-user: #ffffff; --msg-ai: #e9e9eb;
            --primary: #ff4757; --input-bg: #1c1c1e; --pill: #2c2c2e;
        }
        [data-theme="dark"] {
            --bg-body: #000; --bg-app: #121212; --bg-chat: #1c1c1e;
            --text: #fff; --msg-user: #2c2c2e; --msg-ai: #3a3a3c; --input-bg: #000;
        }

        body { 
            font-family: -apple-system, sans-serif; margin: 0; height: 100vh; 
            display: flex; justify-content: center; align-items: center;
            background: var(--bg-body); transition: 0.3s; overflow: hidden;
        }

        #install-popup {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; background: white; padding: 20px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 1000; display: none; text-align: center;
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .popup-btns { display: flex; gap: 10px; margin-top: 15px; }
        .popup-btns button { flex: 1; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; }

        #settings-menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(20px);
            z-index: 100; display: none; padding: 40px 25px; flex-direction: column; box-sizing: border-box;
        }
        [data-theme="dark"] #settings-menu { background: rgba(0,0,0,0.7); }

        .app-container {
            width: 100%; max-width: 500px; height: 100vh; background: var(--bg-app);
            display: flex; flex-direction: column; position: relative; box-shadow: 0 0 40px rgba(0,0,0,0.1);
        }

        .header { padding: 15px 20px; border-bottom: 1px solid rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-weight: 800; color: var(--text); font-size: 18px; }
        .logo span { color: var(--primary); }

        #chat-container { flex: 1; overflow-y: auto; padding: 20px; background: var(--bg-chat); display: flex; flex-direction: column; gap: 12px; }

        .message { 
            max-width: 80%; padding: 12px 16px; border-radius: 18px; font-size: 15px; 
            position: relative; animation: pop 0.3s ease; color: var(--text); 
        }
        
        /* SPECIAL GOLD STYLE FOR OWNER BIO */
        .owner-style {
            background: linear-gradient(135deg, #ffd700, #ffae00) !important;
            color: #000 !important;
            border: 2px solid #fff;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        @keyframes pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .user { align-self: flex-end; background: var(--msg-user); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .ai { align-self: flex-start; background: var(--msg-ai); padding-bottom: 35px; }

        .wave-container { display: none; align-items: center; gap: 3px; height: 20px; margin-right: 10px; }
        .wave-bar { width: 3px; height: 100%; background: var(--primary); border-radius: 10px; animation: wave 0.8s infinite ease-in-out; }
        .wave-bar:nth-child(2) { animation-delay: 0.1s; } .wave-bar:nth-child(3) { animation-delay: 0.2s; }
        @keyframes wave { 0%, 100% { height: 5px; } 50% { height: 20px; } }

        .bottom-bar { background: #1c1c1e; padding: 15px 20px; display: flex; align-items: center; gap: 12px; }
        .input-pill { flex: 1; background: var(--pill); border-radius: 25px; display: flex; align-items: center; padding: 0 15px; }
        input { flex: 1; background: transparent; border: none; color: white; padding: 12px 0; outline: none; }
        
        button { background: none; border: none; color: #8e8e93; font-size: 18px; cursor: pointer; }
        .active-mic { color: var(--primary); transform: scale(1.2); }
        .copy-btn { position: absolute; bottom: 8px; right: 12px; font-size: 12px; color: #8e8e93; }
    </style>
</head>
<body data-theme="light">

    <div id="install-popup">
        <h3 style="color:black">Install Reflex AI?</h3>
        <p style="color:#666">Install this app for a better experience on your phone.</p>
        <div class="popup-btns">
            <button onclick="installApp()" style="background:black; color:white">Yes</button>
            <button onclick="closeInstall()" style="background:#eee; color:#555">No</button>
        </div>
    </div>

    <div id="settings-menu">
        <h2 style="color:var(--text)">Settings</h2>
        <button onclick="localStorage.removeItem('rx_h'); location.reload();" style="background:var(--primary); color:white; padding:12px; border-radius:10px; width:100%;">Clear Chat History</button>
        <button onclick="toggleSettings()" style="margin-top:20px; color:var(--text); width:100%;">Close</button>
    </div>

    <div class="app-container">
        <div class="header">
            <div style="display:flex; align-items:center; gap:10px;">
                <i class="fas fa-bars" onclick="toggleSettings()" style="color:var(--text); cursor:pointer"></i>
                <div class="logo">REFLEX<span>.AI</span></div>
            </div>
            <div>
                <i id="tIcon" class="fas fa-moon" onclick="toggleTheme()" style="color:var(--text); cursor:pointer; margin-right:15px;"></i>
                <i class="fas fa-cog" onclick="toggleSettings()" style="color:var(--text); cursor:pointer"></i>
            </div>
        </div>

        <div id="chat-container"></div>

        <div class="bottom-bar">
            <div class="input-pill">
                <div class="wave-container" id="wave"><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div></div>
                <input type="text" id="userInput" placeholder="Ask Reflex AI...">
                <button id="micBtn"><i class="fas fa-microphone"></i></button>
            </div>
            <button onclick="handleInput()" style="color:white"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <script>
        const KEY = "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";
        const sndSend = new Audio('https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3');
        const sndRec = new Audio('https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3');
        let deferredPrompt;

        window.onload = () => {
            const h = localStorage.getItem('rx_h');
            if (h) document.getElementById('chat-container').innerHTML = h;
            else appendMessage('ai', "Hello! I am Reflex AI. Created by Faissal.");
            if (localStorage.getItem('rx_theme') === 'dark') toggleTheme();
        };

        function toggleTheme() {
            const b = document.body; const isD = b.getAttribute('data-theme') === 'dark';
            b.setAttribute('data-theme', isD ? 'light' : 'dark');
            document.getElementById('tIcon').className = isD ? 'fas fa-moon' : 'fas fa-sun';
            localStorage.setItem('rx_theme', isD ? 'light' : 'dark');
        }

        function toggleSettings() {
            const s = document.getElementById('settings-menu');
            s.style.display = s.style.display === 'flex' ? 'none' : 'flex';
        }

        window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; document.getElementById('install-popup').style.display = 'block'; });
        function installApp() { if(deferredPrompt) { deferredPrompt.prompt(); deferredPrompt = null; } closeInstall(); }
        function closeInstall() { document.getElementById('install-popup').style.display = 'none'; }

        function appendMessage(role, text, isSpecial = false) {
            const chat = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.className = `message ${role} ${isSpecial ? 'owner-style' : ''}`;
            
            if (role === 'ai') {
                const badge = isSpecial ? '⭐ <b>VERIFIED GENIUS</b><br>' : '<b>Reflex AI</b><br>';
                div.innerHTML = `${badge}<span class="txt">${text}</span><button class="copy-btn" onclick="copyText(this)"><i class="far fa-copy"></i></button>`;
                sndRec.play();
                if (!/[\u0600-\u06FF]/.test(text)) speak(text);
            } else { div.innerText = text; sndSend.play(); }
            
            chat.appendChild(div); chat.scrollTop = chat.scrollHeight;
            localStorage.setItem('rx_h', chat.innerHTML);
        }

        function speak(t) { window.speechSynthesis.cancel(); const u = new SpeechSynthesisUtterance(t); u.rate = 1.4; window.speechSynthesis.speak(u); }

        const micBtn = document.getElementById('micBtn');
        const wave = document.getElementById('wave');
        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;

        if (Speech) {
            const rec = new Speech();
            rec.lang = 'ar-MA';
            rec.onstart = () => { micBtn.classList.add('active-mic'); wave.style.display = 'flex'; };
            rec.onend = () => { micBtn.classList.remove('active-mic'); wave.style.display = 'none'; };
            rec.onresult = (e) => { document.getElementById('userInput').value = e.results[0][0].transcript; handleInput(); };
            micBtn.onclick = () => { if(window.speechSynthesis.speaking) window.speechSynthesis.cancel(); rec.start(); };
        }

        async function handleInput() {
            const inp = document.getElementById('userInput');
            const val = inp.value.trim();
            if (!val) return;

            const ownerKeywords = ["owner", "who made", "creator", "faissal", "who is the boss", "who built"];
            if (ownerKeywords.some(key => val.toLowerCase().includes(key))) {
                appendMessage('user', val);
                inp.value = '';
                const bio = "The owner of this app is Faissal. He lives in Morocco and he is 17 years old. He is honestly a genius guy—he built this entire app alone, brick by brick! He's incredibly cool and talented. \n\nTikTok: vyn_soul \nInstagram: vyn_soul";
                appendMessage('ai', bio, true);
                return;
            }

            appendMessage('user', val);
            inp.value = '';

            try {
                const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${KEY}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "llama-3.3-70b-versatile",
                        messages: [{ role: "system", content: "You are Reflex AI. Answer in Arabic/Darija if asked. Be helpful." }, { role: "user", content: val }]
                    })
                });
                const data = await res.json();
                appendMessage('ai', data.choices[0].message.content);
            } catch (e) { appendMessage('ai', "Error connecting."); }
        }

        function copyText(btn) {
            navigator.clipboard.writeText(btn.parentElement.querySelector('.txt').innerText);
            btn.innerHTML = '<i class="fas fa-check"></i>';
            setTimeout(() => btn.innerHTML = '<i class="far fa-copy"></i>', 2000);
        }
    </script>
</body>
</html>
