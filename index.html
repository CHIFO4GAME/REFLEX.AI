<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reflex AI - Public Server</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #8b5cf6;
            --bg: #030712;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --gold-gradient: linear-gradient(90deg, #ffd700, #ff8c00, #ffd700);
            --pro-blue: linear-gradient(90deg, #00d2ff, #3a7bd5, #00d2ff);
        }

        /* 1. WAVY PURPLE/BLACK/WHITE BACKGROUND */
        body { 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center;
            overflow: hidden;
            background: linear-gradient(270deg, #000000, #1a1a1a, #4b0082, #ffffff, #000000);
            background-size: 800% 800%;
            animation: waveBackground 20s ease infinite;
        }

        @keyframes waveBackground {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* 2. COOL OPENING ANIMATION */
        .app-container {
            width: 95%; max-width: 900px; height: 85vh;
            background: var(--glass); backdrop-filter: blur(25px);
            border: 1px solid var(--border); border-radius: 24px;
            display: flex; flex-direction: column; overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            position: relative; z-index: 10;
            animation: appEntry 1.2s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }

        @keyframes appEntry {
            0% { opacity: 0; transform: scale(0.8) translateY(50px); filter: blur(10px); }
            100% { opacity: 1; transform: scale(1) translateY(0); filter: blur(0); }
        }

        .header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); }
        .logo { font-weight: 900; font-size: 22px; letter-spacing: -1px; color: white; }
        
        /* MIC BUTTON & SOUND ANIMATION */
        .mic-btn {
            background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--border);
            width: 45px; height: 45px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .mic-btn.active {
            background: #ef4444;
            animation: pulseMic 1.5s infinite;
        }
        @keyframes pulseMic {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        #chat-container { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 80%; padding: 15px; border-radius: 15px; line-height: 1.5; font-size: 15px; animation: fadeIn 0.3s ease; }
        .user { align-self: flex-end; background: var(--primary); color: white; border-bottom-right-radius: 2px; }
        .ai { align-self: flex-start; background: rgba(255,255,255,0.1); border: 1px solid var(--border); border-bottom-left-radius: 2px; color: #e5e7eb; }

        .input-box { padding: 20px; display: flex; gap: 10px; background: rgba(0,0,0,0.3); align-items: center;}
        input { flex: 1; padding: 15px; border-radius: 12px; border: 1px solid var(--border); background: rgba(255,255,255,0.05); color: white; outline: none; }
        .send-btn { padding: 15px 25px; border-radius: 12px; border: none; background: #fff; color: #000; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="app-container" id="main-app">
        <div class="header">
            <div class="logo">REFLEX<span style="color:var(--primary)">.AI</span></div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <button id="installBtn" class="mic-btn" style="display:none; background: #10b981;"><i class="fa-solid fa-download"></i></button>
                <button class="btn-pro btn-subscribe" style="padding: 8px 12px; border-radius: 8px; border:none; background-image: var(--gold-gradient); font-weight:bold; cursor:pointer;">PRO</button>
            </div>
        </div>

        <div id="chat-container">
            <div class="message ai">âœ¨ Welcome! System ready. Voice mode active.</div>
        </div>

        <div class="input-box">
            <button id="voiceBtn" class="mic-btn"><i class="fas fa-microphone"></i></button>
            <input type="text" id="userInput" placeholder="Type or use voice...">
            <button class="send-btn" onclick="handleInput()">Send</button>
        </div>
    </div>

    <script>
        const KEY = "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";
        let messageCount = 0;
        const voiceBtn = document.getElementById('voiceBtn');
        const userInput = document.getElementById('userInput');

        // --- SPEECH RECOGNITION (LISTENING) ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-US';

            voiceBtn.onclick = () => {
                recognition.start();
                voiceBtn.classList.add('active');
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                userInput.value = transcript;
                voiceBtn.classList.remove('active');
                handleInput(); // Auto-send after speaking
            };

            recognition.onspeechend = () => {
                recognition.stop();
                voiceBtn.classList.remove('active');
            };
        }

        // --- TEXT TO SPEECH (TALKING BACK) ---
        function speak(text) {
            const synth = window.speechSynthesis;
            const utterThis = new SpeechSynthesisUtterance(text);
            utterThis.pitch = 1;
            utterThis.rate = 1;
            synth.speak(utterThis);
        }

        async function handleInput() {
            const val = userInput.value.trim();
            if (!val) return;
            appendMessage('user', val);
            userInput.value = '';
            
            // AI CALL
            const loading = appendMessage('ai', 'Thinking... ðŸŒ€');
            
            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${KEY}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "llama-3.3-70b-versatile",
                        messages: [
                            // EMOJI CONTROL: Instructed to use them sparingly
                            { role: "system", content: "You are Reflex AI. Use icons and emojis sparinglyâ€”only one or two per message. Provide helpful, clean answers." },
                            { role: "user", content: val }
                        ]
                    })
                });
                const data = await response.json();
                const aiText = data.choices[0].message.content;
                loading.remove();
                appendMessage('ai', aiText);
                speak(aiText); // Talk back!
            } catch (err) {
                loading.innerText = "âš ï¸ Error.";
            }
        }

        function appendMessage(role, text) {
            const chat = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.className = `message ${role}`;
            div.innerHTML = text;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
            return div;
        }

        // PWA Install logic (Android Only)
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            if (/Android/i.test(navigator.userAgent)) {
                document.getElementById('installBtn').style.display = 'flex';
            }
        });

        document.getElementById('installBtn').addEventListener('click', () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt = null;
            }
        });
    </script>
</body>
</html>
